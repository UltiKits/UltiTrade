# UltiTrade

[![UltiTools-API](https://img.shields.io/badge/UltiTools--API-6.x-blue)](https://github.com/UltiKits/UltiTools-Reborn)
[![Minecraft](https://img.shields.io/badge/Minecraft-1.13--1.21-green)](https://www.spigotmc.org/)
[![Java](https://img.shields.io/badge/Java-8+-orange)](https://www.java.com/)

UltiTrade æ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„ Minecraft ç©å®¶é—´äº¤æ˜“ç³»ç»Ÿæ’ä»¶ï¼ŒåŸºäº UltiTools-API æ¡†æ¶å¼€å‘ã€‚æ”¯æŒç‰©å“ã€é‡‘å¸ã€ç»éªŒäº¤æ˜“ï¼Œå…·æœ‰å®Œå–„çš„å®‰å…¨æœºåˆ¶å’Œä¸°å¯Œçš„ç”¨æˆ·ä½“éªŒåŠŸèƒ½ã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### æ ¸å¿ƒäº¤æ˜“åŠŸèƒ½
- ğŸ”„ **å®‰å…¨ç‰©å“äº¤æ˜“** - åŒæ–¹ç¡®è®¤æœºåˆ¶ï¼Œé˜²æ­¢æ¬ºè¯ˆ
- ğŸ’° **é‡‘å¸äº¤æ˜“** - é›†æˆ Vault ç»æµç³»ç»Ÿï¼Œæ”¯æŒç¨æ”¶
- â­ **ç»éªŒäº¤æ˜“** - æ”¯æŒç»éªŒå€¼äº¤æ¢ï¼Œå¯é…ç½®ç¨ç‡
- â±ï¸ **è¶…æ—¶æœºåˆ¶** - å¯é…ç½®çš„äº¤æ˜“è¯·æ±‚è¶…æ—¶æ—¶é—´

### ç”¨æˆ·ä½“éªŒ
- ğŸ¯ **BossBar å€’è®¡æ—¶** - ç›´è§‚æ˜¾ç¤ºäº¤æ˜“è¯·æ±‚å‰©ä½™æ—¶é—´
- ğŸ–±ï¸ **å¯ç‚¹å‡»æŒ‰é’®** - èŠå¤©æ¶ˆæ¯ä¸­çš„ [æ¥å—]/[æ‹’ç»] æŒ‰é’®
- ğŸ‘† **Shift+å³é”®äº¤æ˜“** - å¿«æ·å‘èµ·äº¤æ˜“è¯·æ±‚
- ğŸ”Š **éŸ³æ•ˆåé¦ˆ** - äº¤æ˜“æˆåŠŸ/å¤±è´¥/ç‰©å“æ”¾ç½®ç­‰éŸ³æ•ˆ
- âœ¨ **ç²’å­ç‰¹æ•ˆ** - äº¤æ˜“å®Œæˆæ—¶çš„è§†è§‰æ•ˆæœ
- ğŸ“‹ **ç‰©å“è¯¦æƒ…é¢„è§ˆ** - æ‚¬æµ®æ˜¾ç¤ºé™„é­”ã€è€ä¹…åº¦ç­‰ä¿¡æ¯

### å®‰å…¨ä¸ç®¡ç†

- ğŸš« **ç©å®¶é»‘åå•** - å±è”½ä¸æƒ³äº¤æ˜“çš„ç©å®¶
- ğŸ” **äº¤æ˜“å¼€å…³** - ç©å®¶å¯è‡ªä¸»å¼€å…³äº¤æ˜“åŠŸèƒ½
- âš ï¸ **å¤§é¢äº¤æ˜“ç¡®è®¤** - è¶…è¿‡é˜ˆå€¼è‡ªåŠ¨å¼¹å‡ºç¡®è®¤ç•Œé¢
- ğŸ“Š **äº¤æ˜“æ—¥å¿—** - è®°å½•æ‰€æœ‰äº¤æ˜“ï¼Œæ”¯æŒè‡ªåŠ¨æ¸…ç†
- ğŸ“ˆ **PlaceholderAPI** - äº¤æ˜“ç»Ÿè®¡å˜é‡æ”¯æŒ

## ğŸ“¦ å®‰è£…

1. å®‰è£…å‰ç½®æ’ä»¶ï¼š
   - [UltiTools-API](https://github.com/UltiKits/UltiTools-Reborn) (å¿…éœ€)
   - [Vault](https://www.spigotmc.org/resources/vault.34315/) (é‡‘å¸äº¤æ˜“)
   - [PlaceholderAPI](https://www.spigotmc.org/resources/placeholderapi.6245/) (å¯é€‰)

2. å°† `UltiTrade.jar` æ”¾å…¥ `plugins/UltiTools/plugins/` ç›®å½•

3. é‡å¯æœåŠ¡å™¨æˆ–ä½¿ç”¨ `/ultitools reload`

## ğŸ® å‘½ä»¤

| å‘½ä»¤ | æƒé™ | æè¿° |
|------|------|------|
| `/trade <ç©å®¶>` | `ultitrade.use` | å‘ç©å®¶å‘èµ·äº¤æ˜“è¯·æ±‚ |
| `/trade accept` | `ultitrade.use` | æ¥å—äº¤æ˜“è¯·æ±‚ |
| `/trade deny` | `ultitrade.use` | æ‹’ç»äº¤æ˜“è¯·æ±‚ |
| `/trade cancel` | `ultitrade.use` | å–æ¶ˆå½“å‰äº¤æ˜“ |
| `/trade toggle` | `ultitrade.use` | å¼€å¯/å…³é—­äº¤æ˜“åŠŸèƒ½ |
| `/trade block <ç©å®¶>` | `ultitrade.use` | å±è”½æŒ‡å®šç©å®¶ |
| `/trade unblock <ç©å®¶>` | `ultitrade.use` | å–æ¶ˆå±è”½ç©å®¶ |

**å‘½ä»¤åˆ«å:** `/t`

## âš™ï¸ é…ç½®

```yaml
# åŸºç¡€è®¾ç½®
requestTimeout: 30           # äº¤æ˜“è¯·æ±‚è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
maxDistance: 50              # æœ€å¤§äº¤æ˜“è·ç¦»ï¼ˆ-1 æ— é™åˆ¶ï¼‰
allowCrossWorld: false       # æ˜¯å¦å…è®¸è·¨ä¸–ç•Œäº¤æ˜“

# äº¤æ˜“åŠŸèƒ½
enableMoneyTrade: true       # å¯ç”¨é‡‘å¸äº¤æ˜“
enableExpTrade: true         # å¯ç”¨ç»éªŒäº¤æ˜“
enableShiftClick: true       # å¯ç”¨ Shift+å³é”®å‘èµ·äº¤æ˜“

# ç¨æ”¶è®¾ç½®
tradeTax: 0.0                # é‡‘å¸äº¤æ˜“ç¨ç‡ï¼ˆ0-1ï¼‰
expTaxRate: 0.0              # ç»éªŒäº¤æ˜“ç¨ç‡ï¼ˆ0-1ï¼‰

# å¤§é¢äº¤æ˜“ç¡®è®¤
confirmThreshold: 10000      # ç¡®è®¤é˜ˆå€¼ï¼ˆé‡‘å¸æˆ–ç»éªŒï¼‰

# æ—¥å¿—è®¾ç½®
enableTradeLog: true         # å¯ç”¨äº¤æ˜“æ—¥å¿—
logRetentionDays: 30         # æ—¥å¿—ä¿ç•™å¤©æ•°
cleanupIntervalHours: 24     # æ¸…ç†é—´éš”ï¼ˆå°æ—¶ï¼‰

# æ•ˆæœè®¾ç½®
enableSounds: true           # å¯ç”¨éŸ³æ•ˆ
enableParticles: true        # å¯ç”¨ç²’å­æ•ˆæœ
enableBossbar: true          # å¯ç”¨ BossBar å€’è®¡æ—¶
enableClickableButtons: true # å¯ç”¨èŠå¤©å¯ç‚¹å‡»æŒ‰é’®
```

## ğŸ“Š PlaceholderAPI å˜é‡

| å˜é‡ | æè¿° |
|------|------|
| `%ultitrade_total_trades%` | ç©å®¶æ€»äº¤æ˜“æ¬¡æ•° |
| `%ultitrade_total_money%` | ç©å®¶æ€»äº¤æ˜“é‡‘é¢ |
| `%ultitrade_total_exp%` | ç©å®¶æ€»äº¤æ˜“ç»éªŒ |
| `%ultitrade_trade_enabled%` | äº¤æ˜“æ˜¯å¦å¼€å¯ |
| `%ultitrade_is_trading%` | æ˜¯å¦æ­£åœ¨äº¤æ˜“ä¸­ |
| `%ultitrade_last_trade_time%` | ä¸Šæ¬¡äº¤æ˜“æ—¶é—´ |
| `%ultitrade_blocked_count%` | é»‘åå•ç©å®¶æ•°é‡ |

## ğŸ¨ GUI ç•Œé¢

äº¤æ˜“ç•Œé¢é‡‡ç”¨ 54 æ ¼å¤§ç®±å­å¸ƒå±€ï¼š

```
[ä½ çš„ç‰©å“åŒº 4x4] | [åˆ†éš”çº¿] | [å¯¹æ–¹ç‰©å“åŒº 4x4]
[é‡‘å¸] [çŠ¶æ€] [ç»éªŒ] |   | [ç»éªŒ] [çŠ¶æ€] [é‡‘å¸]
[å–æ¶ˆ] [...] [...] [ç¡®è®¤] [...] [...] [...]
```

### ç‰©å“è¯¦æƒ…é¢„è§ˆ

æ‚¬æµ®åœ¨å¯¹æ–¹ç‰©å“ä¸Šå¯æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ï¼š

- é™„é­”åˆ—è¡¨åŠç­‰çº§
- è€ä¹…åº¦ç™¾åˆ†æ¯”
- ç‰©å“æ ‡å¿—
- è‡ªå®šä¹‰æ¨¡å‹æ•°æ®
- æ— æ³•ç ´åæ ‡è®°

## ğŸ“ æ›´æ–°æ—¥å¿—

### v2.0.0
- æ–°å¢ç»éªŒäº¤æ˜“åŠŸèƒ½
- æ–°å¢ç©å®¶é»‘åå•ç³»ç»Ÿ
- æ–°å¢äº¤æ˜“å¼€å…³åŠŸèƒ½
- æ–°å¢ BossBar è¯·æ±‚å€’è®¡æ—¶
- æ–°å¢å¯ç‚¹å‡»èŠå¤©æŒ‰é’®
- æ–°å¢ Shift+å³é”®å¿«æ·äº¤æ˜“
- æ–°å¢å¤§é¢äº¤æ˜“ç¡®è®¤æœºåˆ¶
- æ–°å¢äº¤æ˜“æ—¥å¿—ç³»ç»Ÿ
- æ–°å¢ PlaceholderAPI é›†æˆ
- æ–°å¢éŸ³æ•ˆå’Œç²’å­ç‰¹æ•ˆ
- æ–°å¢ç‰©å“è¯¦æƒ…æ‚¬æµ®é¢„è§ˆ
- ä¼˜åŒ– GUI ç•Œé¢å¸ƒå±€
- ä¼˜åŒ–ä»£ç ç»“æ„ï¼Œä½¿ç”¨ UltiTools-API æ¡†æ¶

### v1.0.0
- åˆå§‹ç‰ˆæœ¬
- åŸºç¡€ç‰©å“å’Œé‡‘å¸äº¤æ˜“åŠŸèƒ½

## ğŸ”§ æŠ€æœ¯æ¶æ„

- **æ¡†æ¶**: UltiTools-API 6.2.0+
- **æ³¨è§£é©±åŠ¨**: `@Service`, `@Autowired`, `@CmdMapping`, `@Table`, `@Scheduled`
- **æ•°æ®æŒä¹…åŒ–**: Query DSL + DataOperator ORM
- **ä¾èµ–æ³¨å…¥**: UltiTools IoC å®¹å™¨
- **é…ç½®éªŒè¯**: `@Range`, `@NotEmpty` validation annotations

### UltiTools-API 6.2.0 æ–°ç‰¹æ€§åº”ç”¨

æœ¬æ’ä»¶å·²å®Œå…¨è¿ç§»åˆ° UltiTools-API 6.2.0 çš„ç°ä»£åŒ–æ¨¡å¼ï¼š

#### 1. Query DSL (æŸ¥è¯¢æ„å»ºå™¨)

```java
// æ—§æ¨¡å¼
List<PlayerTradeSettings> settings = settingsOperator.getAll(
    WhereCondition.builder().column("player_uuid").value(uuid).build()
);

// æ–°æ¨¡å¼ - æµå¼ API
List<PlayerTradeSettings> settings = settingsOperator.query()
    .where("player_uuid").eq(uuid)
    .list();
```

#### 2. @Scheduled ä»»åŠ¡ç³»ç»Ÿ

```java
// è‡ªåŠ¨æ³¨å†Œçš„å®šæ—¶ä»»åŠ¡
@Scheduled(period = 200, async = false)
public void cleanupExpiredRequests() {
    // æ¯10ç§’æ‰§è¡Œä¸€æ¬¡ï¼Œè‡ªåŠ¨ç®¡ç†ç”Ÿå‘½å‘¨æœŸ
}
```

#### 3. é…ç½®éªŒè¯

```java
@Range(min = 5, max = 600)
@ConfigEntry(path = "request-timeout")
private int requestTimeout = 30;

@NotEmpty
@ConfigEntry(path = "gui-title")
private String guiTitle = "&6ä¸ {PLAYER} äº¤æ˜“";
```

#### 4. åŸºç±»è¿ç§»

- `AbstractCommendExecutor` â†’ `BaseCommandExecutor`
- `AbstractDataEntity` â†’ `BaseDataEntity<String>`

### ä¸»è¦ç±»è¯´æ˜

| ç±» | è¯´æ˜ |
|---|---|
| `TradeService` | æ ¸å¿ƒäº¤æ˜“é€»è¾‘æœåŠ¡ |
| `TradeLogService` | æ—¥å¿—è®°å½•å’Œç©å®¶è®¾ç½®ç®¡ç† |
| `TradeGUI` | äº¤æ˜“ç•Œé¢å®ç° |
| `TradeConfirmPage` | å¤§é¢äº¤æ˜“ç¡®è®¤é¡µé¢ |
| `TradeListener` | äº‹ä»¶ç›‘å¬å¤„ç† |
| `TradeCommand` | å‘½ä»¤æ‰§è¡Œå™¨ |
| `TradePlaceholderExpansion` | PlaceholderAPI æ‰©å±• |

### æ•°æ®å®ä½“

| å®ä½“ | ç”¨é€” |
|---|---|
| `TradeLogData` | äº¤æ˜“æ—¥å¿—è®°å½• |
| `PlayerTradeSettings` | ç©å®¶äº¤æ˜“è®¾ç½®å’Œç»Ÿè®¡ |
| `SerializedItemStack` | ç‰©å“åºåˆ—åŒ– (JSON) |
| `TradeSession` | æ´»è·ƒäº¤æ˜“ä¼šè¯ |

## ğŸ“œ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Pull Request æˆ–åˆ›å»º Issueï¼

## ğŸ”— ç›¸å…³é“¾æ¥

- [UltiTools-API æ–‡æ¡£](https://doc.dev.ultikits.com/)
- [UltiKits å®˜ç½‘](https://www.ultikits.com/)
- [SpigotMC](https://www.spigotmc.org/)
